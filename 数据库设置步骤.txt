===============================================================================
              PostgreSQL 数据库设置 - 5 分钟快速指南
===============================================================================

解决问题：每次创建激活码后不需要手动更新环境变量，自动永久保存

===============================================================================
                            【第一步】创建数据库
===============================================================================

1. 访问：https://dashboard.render.com/
2. 点击右上角：New + → PostgreSQL
3. 填写信息：
   Name: azvoiceclone-db
   Database: azvoiceclone
   Region: Oregon (与 Web Service 相同)
   Plan: Free ← 重要！选择免费
4. 点击：Create Database
5. 等待 2-3 分钟创建完成

===============================================================================
                        【第二步】复制数据库连接 URL
===============================================================================

1. 点击刚创建的数据库 azvoiceclone-db
2. 找到 Connections 部分
3. 复制 Internal Database URL（类似下面格式）：

   postgres://azvoiceclone_user:密码@dpg-xxx-a.oregon-postgres.render.com/azvoiceclone

   ⚠️ 重要：复制 Internal URL，不是 External URL

===============================================================================
                    【第三步】配置 Web Service 环境变量
===============================================================================

1. 返回 Dashboard，选择 azvoiceclone 服务
2. 点击左侧：Environment 标签
3. 点击：Add Environment Variable
4. 输入：
   Key（变量名）: DATABASE_URL
   Value（变量值）: 粘贴步骤 2 复制的 URL
5. 点击：Save Changes

Render 会自动重新部署（约 3-5 分钟）

===============================================================================
                            【第四步】验证
===============================================================================

部署完成后：

1. 查看日志（Logs 标签），应该看到：
   ✓ [激活码管理] 检测到 DATABASE_URL，使用 PostgreSQL 持久化存储

2. 访问管理后台：https://vipvoice3.aipush.fun/azttsadmin/

3. 创建新激活码 → 自动保存到数据库 ✓

4. 手动重启服务测试（Settings → Manual Deploy）

5. 重启后激活码仍然存在 ✓

===============================================================================
                              完成！
===============================================================================

现在起，每次在管理后台创建的激活码会自动永久保存到数据库中。

✅ 无需运行命令
✅ 无需更新环境变量
✅ 重启后数据不丢失

===============================================================================
                            常见问题
===============================================================================

Q: 数据库免费吗？
A: 是的，Render 提供 1GB 免费数据库，可以存储数百万条激活码。
   但有效期 90 天，到期后需要重新创建。

Q: 旧的激活码怎么办？
A: 配置数据库后，在管理后台重新创建即可。旧激活码会丢失。

Q: 如果不想用数据库呢？
A: 不设置 DATABASE_URL 环境变量，应用会自动使用 JSON 文件。
   但 Render 上重启会丢失数据，需要用环境变量方案（见：激活码环境变量.txt）

Q: 数据库连接失败怎么办？
A: 检查 DATABASE_URL 是否使用 Internal URL，以及数据库和服务是否在同一区域。

===============================================================================

详细文档：RENDER_DATABASE_SETUP.md

===============================================================================